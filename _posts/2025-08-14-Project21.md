---
title: "Kickytime β€“ λ°°ν¬ & μ΄μ (AWS μΈν”„λΌ)"
author: mminzy22
date: 2025-08-14 21:00:00 +0900
categories: [ν”„λ΅μ νΈ, Kickytime]
tags: [TIL, ν”„λ΅μ νΈ, Kickytime, AWS, DevOps, λ°°ν¬, μΈν”„λΌ, λ³΄μ•]
description: "Kickytime ν”„λ΅μ νΈμ AWS κΈ°λ° λ°°ν¬ λ° μ΄μ ν™κ²½ κµ¬μ„± κ³Όμ • μ •λ¦¬."
media_subpath: /assets/img/kickytime
pin: false
mermaid: true
image:
  path: Project.drawio.png
  alt: "Kickytime λ„¤νΈμ›ν¬ μ•„ν‚¤ν…μ² λ‹¤μ΄μ–΄κ·Έλ¨"
---


## κ°μ”

μ΄ κΈ€μ—μ„λ” **Kickytime ν”„λ΅μ νΈ**λ¥Ό AWS ν™κ²½μ— λ°°ν¬ν•λ©΄μ„ κµ¬μ„±ν• λ„¤νΈμ›ν¬ μ•„ν‚¤ν…μ², λ³΄μ• κ·Έλ£Ή, VPC μ—”λ“ν¬μΈνΈ, IAM, KMS, RDS μ ‘κ·Ό λ°©μ‹ λ“± **μ΄μ μΈν”„λΌ μΈ΅λ©΄**μ„ μ •λ¦¬ν•©λ‹λ‹¤. λ‹¨μν λ™μ‘ν•λ” λ°°ν¬λ¥Ό λ„μ–΄, **λ³΄μ•μ„±κ³Ό μ΄μ ν¨μ¨μ„±**μ„ ν•¨κ» κ³ λ ¤ν–μµλ‹λ‹¤.

---

## λ„¤νΈμ›ν¬ μ•„ν‚¤ν…μ²

μ²¨λ¶€ν• λ‹¤μ΄μ–΄κ·Έλ¨μ€ VPC λ‚΄λ¶€ κµ¬μ„±μ…λ‹λ‹¤.

* **νΌλΈ”λ¦­ μ„λΈλ„·**: ALB, NAT κ²μ΄νΈμ›¨μ΄ λ°°μΉ
* **ν”„λΌμ΄λΉ— μ„λΈλ„·**: EC2(/api/matches*), ECS(/api/users*), RDS(PostgreSQL)
* **CloudFront β†’ ALB β†’ App(ECS/EC2) β†’ RDS** νλ¦„
* κ΄€λ¦¬ νΈλν”½μ€ **SSM Session Manager**μ™€ **VPC μ—”λ“ν¬μΈνΈ**λ¥Ό ν†µν•΄ μ²λ¦¬

```mermaid
graph TD
  A[CloudFront] -->|443| B[ALB]
  B -->|8080| C[EC2/ECS]
  C -->|5432| D[RDS]
  C --> E[VPC Endpoints]
```

---

## λ³΄μ• κ·Έλ£Ή μ„¤μ •

μ„λΉ„μ¤λ³„ μµμ† κ¶ν• μ›μΉ™(Least Privilege)μ„ μ μ©ν–μµλ‹λ‹¤.

| μ΄λ¦„                    | λ€μƒ        | ν¬νΈ   | μ†μ¤                     | μ„¤λ…                        |
| --------------------- | --------- | ---- | ---------------------- | ------------------------- |
| **kickytime-alb-sg**  | ALB       | 443  | CloudFront Prefix List | CloudFront β†’ ALB ν—μ©       |
|                       |           | 80   | 0.0.0.0/0              | HTTP β†’ HTTPS λ¦¬λ‹¤μ΄λ ‰νΈ μ© (μ„ νƒ) |
| **kickytime-app-sg**  | EC2/ECS   | 8080 | ALB SG                 | ALB β†’ App (ν—¬μ¤μ²΄ν¬ ν¬ν•¨)       |
| **kickytime-rds-sg**  | RDS       | 5432 | App SG                 | App β†’ DB μ ‘κ·Ό ν—μ©            |
| **kickytime-vpce-sg** | VPC μ—”λ“ν¬μΈνΈ | 443  | App SG                 | SSM/Logs/ECR/KMS λ“± λ‚΄λ¶€ ν†µμ‹   |

---

## VPC μ—”λ“ν¬μΈνΈ κµ¬μ„±

ν”„λΌμ΄λΉ— μ„λΈλ„· λ¦¬μ†μ¤λ“¤μ΄ NAT μ—†μ΄λ„ AWS μ„λΉ„μ¤μ— μ ‘κ·Όν•  μ μλ„λ΅ **Interface Endpoint**λ¥Ό μƒμ„±ν–μµλ‹λ‹¤.

* `com.amazonaws.ap-northeast-2.ecr.api`
* `com.amazonaws.ap-northeast-2.ecr.dkr`
* `com.amazonaws.ap-northeast-2.logs`
* `com.amazonaws.ap-northeast-2.secretsmanager`
* `com.amazonaws.ap-northeast-2.kms`
* `com.amazonaws.ap-northeast-2.ssm`
* `com.amazonaws.ap-northeast-2.ssmmessages`
* `com.amazonaws.ap-northeast-2.ec2messages`

μ΄λ΅μ¨ App μ„λ²„κ°€ **μ΄λ―Έμ§€ Pull, λ΅κ·Έ μ „μ†΅, λΉ„λ°€ κ΄€λ¦¬, KMS μ•”νΈν™”/λ³µνΈν™”**λ¥Ό λ¨λ‘ μ‚¬μ„¤ λ„¤νΈμ›ν¬ λ‚΄μ—μ„ μ²λ¦¬ κ°€λ¥ν•κ² λμ—μµλ‹λ‹¤.

---

## RDS μ ‘κ·Ό (SSM ν¬νΈν¬μ›λ”©)

μ΄μ ν™κ²½μ—μ„λ” RDSλ¥Ό νΌλΈ”λ¦­ν•κ² λ…Έμ¶ν•μ§€ μ•κ³ , SSMμ„ ν™μ©ν• ν¬νΈν¬μ›λ”©μΌλ΅λ§ μ ‘κ·Όν•©λ‹λ‹¤.

```bash
aws ssm start-session \
  --region ap-northeast-2 \
  --target EC2μΈμ¤ν„΄μ¤ID \
  --document-name AWS-StartPortForwardingSessionToRemoteHost \
  --parameters '{"host":["RDSμ—”λ“ν¬μΈνΈ"],"portNumber":["5432"],"localPortNumber":["55432"]}'
```

π‘‰ μ΄λ ‡κ² ν•λ©΄ **λ΅μ»¬μ 55432 ν¬νΈ β†” RDS 5432**λ΅ μ•μ „ν•κ² μ—°κ²°λ©λ‹λ‹¤.

---

## IAM κ¶ν• κ΄€λ¦¬

`kickytime μ „μ© IAM Role`μ„ μƒμ„±ν•΄ λ¦¬μ†μ¤λ³„ μµμ† κ¶ν•μ„ λ¶€μ—¬ν–μµλ‹λ‹¤.

* ECS Task Role β†’ Secrets Managerμ—μ„ DB λΉ„λ°€λ²νΈ μ΅°ν
* EC2 Instance Role β†’ SSM/CloudWatch Logs κ¶ν•
* Lambda/λ°°ν¬ Role β†’ ECR, ECS, RDS κ΄€λ¦¬

λ¨λ“  λ¦¬μ†μ¤λ” **Project=Kickytime** νƒκ·Έλ¥Ό κΈ°λ°μΌλ΅ IAM μ •μ±…κ³Ό CloudWatch λ΅κ·Έ κ·Έλ£Ήμ„ κµ¬λ¶„ν–μµλ‹λ‹¤.

---

## KMS & Secrets Manager

* **KMS Customer Managed Key (CMK)** μƒμ„± β†’ `alias/kickytime-key`
* **RDS λΉ„λ°€λ²νΈ**λ” Secrets Managerμ— μ €μ¥ν•κ³ , Appμ€ μ‹¤ν–‰ μ‹ ν•΄λ‹Ή κ°’μ„ μ΅°ν
* RDS μ•”νΈν™”, S3 μ•”νΈν™”μ—λ„ λ™μΌν• KMS ν‚¤ μ‚¬μ©

μ΄λ΅μ¨ λ°μ΄ν„° λ³΄μ•κ³Ό ν‚¤ κ΄€λ¦¬κ°€ μ¤‘μ•™ν™”λμ—μµλ‹λ‹¤.

---

## λ§λ¬΄λ¦¬

μ΄λ² λ°°ν¬ ν™κ²½ κµ¬μ„±μ—μ„ λ°°μ΄ μ :

1. NAT κ²μ΄νΈμ›¨μ΄λ¥Ό μµμ†ν™”ν•κ³  VPC μ—”λ“ν¬μΈνΈλ¥Ό μ κ·Ή ν™μ©ν•λ©΄ λΉ„μ©κ³Ό λ³΄μ• λ¨λ‘ κ°μ„  κ°€λ¥
2. ALB β†’ App β†’ DB νλ¦„μ— λ€ν•΄ λ³΄μ• κ·Έλ£Ήμ„ κ³„μΈµμ μΌλ΅ μ„¤κ³„ν•λ©΄ νΈλν”½ μ μ–΄κ°€ λ…ν™•ν•΄μ§
3. IAM + KMS + Secrets Managerλ¥Ό μ΅°ν•©ν•΄ λ―Όκ°μ •λ³΄(λΉ„λ°€λ²νΈ, μ•”νΈν™” ν‚¤)λ¥Ό μ•μ „ν•κ² κ΄€λ¦¬ν•  μ μμ
